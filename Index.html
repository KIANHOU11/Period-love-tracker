<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æœˆç»ä¸çˆ±çˆ±è®°å½•ï¼ˆå¯†ç ä¿æŠ¤ï¼‰</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background-color: #fff8f0; color: #333; }
    h1 { color: #cc3366; }
    label, select, input, button { display: block; margin-top: 10px; padding: 5px; }
    .section { margin-bottom: 30px; }
    .result { font-weight: bold; margin-top: 10px; }
    #content { display: none; }
    #login { max-width: 300px; margin: 100px auto; }
  </style>
</head>
<body>

<div id="login">
  <h2>è¯·è¾“å…¥è®¿é—®å¯†ç </h2>
  <input type="password" id="passwordInput" placeholder="å¯†ç "/>
  <button onclick="checkPassword()">ç™»å½•</button>
  <p id="error" style="color:red;"></p>
</div>

<div id="content">
  <h1>æœˆç»ä¸çˆ±çˆ±è®°å½•</h1>

  <div class="section">
    <h2>ğŸ©¸ è®°å½•æœˆç»</h2>
    <label>å¼€å§‹æ—¥æœŸï¼š<input type="date" id="periodStart"></label>
    <label>ç»“æŸæ—¥æœŸï¼š<input type="date" id="periodEnd"></label>
    <button onclick="addPeriod()">æ·»åŠ è®°å½•</button>
    <div id="nextPeriod" class="result"></div>
  </div>

  <div class="section">
    <h2>ğŸ‘ çˆ±çˆ±è®°å½•</h2>
    <label>æ˜¯å¦æˆ´å¥—ï¼š
      <select id="withCondom">
        <option value="æ˜¯">æ˜¯</option>
        <option value="å¦">å¦</option>
      </select>
    </label>
    <label>å°„ç²¾æ–¹å¼ï¼š
      <select id="ejaculation">
        <option value="å†…å°„">å†…å°„</option>
        <option value="ä½“å¤–">ä½“å¤–</option>
        <option value="æ— å°„">æ— å°„</option>
      </select>
    </label>
    <button onclick="recordLove()">æ·»åŠ çˆ±çˆ±è®°å½•</button>
    <div id="loveStats" class="result"></div>
  </div>
</div>

<script>
  const correctPassword = "1234"; // ä½ å¯ä»¥æ”¹è¿™é‡Œè®¾ç½®å¯†ç 

  function checkPassword() {
    const input = document.getElementById("passwordInput").value;
    if (input === correctPassword) {
      document.getElementById("login").style.display = "none";
      document.getElementById("content").style.display = "block";
      showNextPeriod();
      showLoveStats();
    } else {
      document.getElementById("error").textContent = "å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•";
    }
  }

  // ä»¥ä¸‹æ˜¯ä¹‹å‰åŠŸèƒ½ä»£ç ï¼Œæœªæ”¹åŠ¨
  const periods = JSON.parse(localStorage.getItem("periods") || "[]");
  const loves = JSON.parse(localStorage.getItem("loves") || "[]");

  function addPeriod() {
    const start = new Date(document.getElementById("periodStart").value);
    const end = new Date(document.getElementById("periodEnd").value);
    if (!start || !end || end <= start) {
      alert("è¯·è¾“å…¥æœ‰æ•ˆçš„èµ·æ­¢æ—¥æœŸï¼");
      return;
    }
    periods.push({ start, end });
    localStorage.setItem("periods", JSON.stringify(periods));
    showNextPeriod();
  }

  function recordLove() {
    const today = new Date().toISOString().slice(0, 10);
    const withCondom = document.getElementById("withCondom").value;
    const ejaculation = document.getElementById("ejaculation").value;
    loves.push({ date: today, withCondom, ejaculation });
    localStorage.setItem("loves", JSON.stringify(loves));
    showLoveStats();
  }

  function showLoveStats() {
    const thisMonth = new Date().toISOString().slice(0, 7);
    const monthly = loves.filter(l => l.date.startsWith(thisMonth));
    const total = monthly.length;
    const inner = monthly.filter(l => l.ejaculation === "å†…å°„").length;
    const outer = monthly.filter(l => l.ejaculation === "ä½“å¤–").length;
    const noEjac = monthly.filter(l => l.ejaculation === "æ— å°„").length;
    const withCondom = monthly.filter(l => l.withCondom === "æ˜¯").length;
    const withoutCondom = monthly.filter(l => l.withCondom === "å¦").length;

    document.getElementById("loveStats").innerHTML = `
      æœ¬æœˆæ€»æ¬¡æ•°ï¼š${total}<br>
      - æˆ´å¥—ï¼š${withCondom} æ¬¡<br>
      - ä¸æˆ´å¥—ï¼š${withoutCondom} æ¬¡<br>
      - å†…å°„ï¼š${inner} æ¬¡<br>
      - ä½“å¤–ï¼š${outer} æ¬¡<br>
      - æ— å°„ï¼š${noEjac} æ¬¡
    `;
  }

  function showNextPeriod() {
    if (periods.length === 0) {
      document.getElementById("nextPeriod").textContent = "æš‚æ— æœˆç»è®°å½•";
      return;
    }
    const last = periods[periods.length - 1];
    const start = new Date(last.start);
    const end = new Date(last.end);
    const duration = (end - start) / (1000 * 3600 * 24);
    const next = new Date(start.getTime() + (28 + duration) * 24 * 3600 * 1000);
    document.getElementById("nextPeriod").textContent = `é¢„è®¡ä¸‹æ¬¡æœˆç»ï¼š${next.toISOString().slice(0,10)}`;
  }
</script>

</body>
</html>
